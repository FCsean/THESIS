<!DOCTYPE HTML>
<html>
<link rel="stylesheet" type="text/css" href="/styles/style.css">

<title>{{template "title" .}}</title>
<body>

	<div class="container">

	    <div class="sideBar">
	      <div class="menuItemsWrapper">
	        <img class="codeRangersLogoSmall" src="/images/logoWhite.png">

	        <div class="sideBarOptionsWrapper">
            <span class = "sideBarItem"><a href="/" class="sideBarItem">Home</a></span>
            {{ if .IsLoggedIn }}<span class = "sideBarItem"><a href="/profile" class="sideBarItem">Personal Records</a></span>
            <br>
            <span class = "sideBarItem"><a href="/submissions" class="sideBarItem">My Submissions</a></span>
            {{ if .IsAdmin }}
            <span class = "sideBarItem"><a href="/add-problem" class="sideBarItem">Create Problem</a></span>
            <span class = "sideBarItem"><a href="/add-skill" class="sideBarItem">Add Skill</a></span>
            {{ end }}
            <span class = "sideBarItem"><a href="/skill-tree" class="sideBarItem">View Skill Tree</a></span>
            <span class = "sideBarItem"><a href="/problems" class="sideBarItem">Browse Problems</a></span>
            <span class = "sideBarItem"><a href="/leaderboards" class="sideBarItem">Leaderboards</a></span>
            <br>
            <form method="POST" action="/logout"><input type="submit" value="Logout"></form>
            {{ end }}
            <!--<span class = "sideBarItem"><a href="/" class="sideBarItem" method="POST" action="/logout" value="logout">Logout</a></span>-->


            <span class = "sideBarItem">{{ if not .IsLoggedIn }} <a href="/login" class="sideBarItem">Log In</a> {{ end }}</span>


            <!-- <button id="myBtn">Open Modal</button> -->
	        </div>
	      </div>
	    </div>
      {{template "content" .}}

	</div>


<!-- /*
show verdict with submission id
cgro
and runtime
kng verdict accepted
check kng may newachievement then show it
kng hindi accepted check relatedproblem to suggest
*/ -->

  <!--Modal Stuff-->
<!--      -->

    <!-- The Modal -->
    <div id="submissionReportModal">

      <!-- Modal content -->
      <div class="modalContent">
        <span class="close">x</span>
        
        <div class="status">
          <span id="submissionId">Sub</span><br>
          <span id="verdict">Ver</span><br>
          <span id="runtime">Run</span><br>
        </div>
        <div id="recommendations"></div>
          <div id="recommendationsContent">Blah</span>
      </div>

    </div>

      <script>
      {{template "script" .}}
        var evtSource = new EventSource('http://localhost/notifications');
        var eventList = document.getElementById('event-list');
        evtSource.onmessage = function(e) {
          var newElement = document.createElement('li');
          var data = JSON.parse(e.data);
          if (data["LoggedOut"] != null) {
            location.reload();
          }

          alert(e.data);


/*          if(data.Submission.Verdict == "accepted"){
            if(data.NewAchievements != null){
              message2 = "Achievement/s unlocked: " + data.NewAchievements;
            }else{
              message2 = "No new achievements unlocked";
            }
          }else{
            message2 = "If you're stuck, I recommend you try this similar problem:\n" + 
                      data.RelatedProblems[0].Title;
          }*/

          document.getElementById("submissionId").innerHTML = "Submission ID: " + data.Submission.ID;
          document.getElementById("verdict").innerHTML = "Verdict: " + data.Submission.Verdict;
          document.getElementById("runtime").innerHTML = "Runtime: " + data.Submission.Runtime;

          if(data.Submission.Verdict == "accepted"){
            if(data.NewAchievements != null){
              document.getElementById("recommendationsContent").innerHTML = "Achievement/s unlocked: " + data.NewAchievements;
            }else{
              document.getElementById("recommendationsContent").innerHTML = "No new achievements unlocked";
            }
          }else{
            if(data.RelatedProblems[0].Title != null){
              document.getElementById("recommendationsContent").innerHTML = "If you're stuck, I recommend you try this similar problem:<br>" + data.RelatedProblems[0].Title;
            }
          }



          var modal = document.getElementById("submissionReportModal");

          // Get the button that opens the modal
          var btn = document.getElementById("myBtn");

          // Get the <span> element that closes the modal
          var span = document.getElementsByClassName("close")[0];

          btn.onclick = function() {
            modal.style.display = "block";
          }

          modal.style.display = "block";

          span.onclick = function() {
              modal.style.display = "none";
          }

          // When the user clicks anywhere outside of the modal, close it
          window.onclick = function(event) {
              if (event.target == modal) {
                  modal.style.display = "none";
              }
          }

          // When the user clicks on <span> (x), close the modal

          //data.Submission.Username

/*          var message1, message2;

          alert(e.data);

          message1 = "Submission ID: " + data.Submission.ID + "\n" +
                        "Verdict: " + data.Submission.Verdict + "\n\n";

          if(data.Submission.Verdict == "accepted"){
            if(data.NewAchievements != null){
              message2 = "Achievement/s unlocked: " + data.NewAchievements;
            }else{
              message2 = "No new achievements unlocked";
            }
          }else{
            message2 = "If you're stuck, I recommend you try this similar problem:\n" + 
                      data.RelatedProblems[0].Title;
          }
          */
/*
show verdict wiith submission id
cgro
and runtime
kng verdict accepted
check kng may newachievement then show it
kng hindi accepted check relatedproblem to suggest
*/
          //alert(message1 + message2);
          //alert(e.data);
        }

        var modal = document.getElementById("submissionReportModal");

          // Get the button that opens the modal
          var btn = document.getElementById("myBtn");

          // Get the <span> element that closes the modal
          var span = document.getElementsByClassName("close")[0];

          btn.onclick = function() {
            modal.style.display = "block";
          }

          //modal.style.display = "block";

          span.onclick = function() {
              modal.style.display = "none";
          }

          // When the user clicks anywhere outside of the modal, close it
          window.onclick = function(event) {
              if (event.target == modal) {
                  modal.style.display = "none";
              }
          }

// MODAL STUFF

        // Get the modal


      </script>
</body>
</html>